# Developer Guide

This document outlines the setup, architecture, and workflows for the Acts Navigation & Analysis system.

## 1. Environment Setup

### Prerequisites
- **Node.js** (v18+ recommended)
- **Python** (v3.8+)
- **Git**

### Installation

1.  **Clone the Repository**:
    ```bash
    git clone <repo-url>
    cd research
    ```

2.  **Web Application**:
    The web interface is built with Next.js.
    ```bash
    cd web
    npm install
    ```

3.  **LDF CLI Tool**:
    Install the research tools as a python package:
    ```bash
    pip install -e .
    ```
    Verify the installation:
    ```bash
    ldf --help
    ```

## 2. Web Application

### Running Locally
To start the development server:
```bash
cd web
npm run dev
```
Visit http://localhost:3000 to view the app.

### Key Components
-   **Dashboard**: `web/components/acts/Dashboard.tsx` - Main visualization hub.
-   **Acts Table**: `web/components/acts/ActsTable.tsx` - Searchable data table.
-   **Lineage Engine**:
    -   `LineageView.tsx`: Visualization (timeline/tree).
    -   `LineageEditorPage.tsx`: Full-screen editor for creating patches.
    -   `LineagePatcher.tsx`: Quick-edit tool.

## 3. Data Workflows

The system uses a TSV file as the source of truth (`acts/research/archive/docs_en_with_domain.tsv`) and generates static JSON for the frontend (`acts.json`, `lineage.json`).

### A. Categorization
If new acts are added to the source, run categorization to assign domains:
```bash
ldf research categorize
```

### B. Lineage Generation (Hot-Patching)
To generate the hierarchical data (`lineage.json`) used by the graph visualizations:
```bash
ldf research lineage
```
*Note: This script automatically looks for JSON patch files in `web/public/data/patches/` and applies them to the output JSON without modifying the source TSV.*

### C. Data Processing (Main Acts JSON)
To generate the flat list of acts (`acts.json`) for the table:
```bash
ldf research process
```

## 4. Data Versioning & Patching

We use a version control system for the data itself to ensure integrity and history.

### Roles
-   **TSV Source**: The raw data file.
-   **Patch**: A JSON file describing a lineage relationship change (e.g. "Act A amended by Act B").
-   **Version**: A snapshot of the TSV file with specific patches applied.

### Workflow

1.  **Create a Patch**:
    -   Go to **Lineage Tools** in the Web App.
    -   Select acts and define relationships.
    -   Download the Patch JSON.
    -   Save it to `acts/research/patches/`.


2.  **Initialize Versioning** (First Time Only):
    Creates `v1` from your current source.
    ```bash
    ldf research version init
    ```

3.  **Apply a Patch**:
    Updates the TSV data by creating a new version (e.g., `v2`) containing the patch changes.
    ```bash
    ldf research version apply --file acts/research/patches/lineage_patch_NAME.json
    ```
    *This modifies the act descriptions in the new TSV branch (e.g., adds " (Amendment)") to verify the relationship.*

4.  **List Versions**:
    See the history of data changes.
    ```bash
    ldf research version list
    ```

## 5. Directory Structure

-   `acts/research/archive/`: Raw historical data.
-   `acts/research/versions/`: Versioned data snapshots (managed by script).
-   `acts/research/patches/`: JSON patch files.
-   `web/public/data/`: Generated JSON files for the frontend application.
-   `scripts/`: Utilities for data processing.
