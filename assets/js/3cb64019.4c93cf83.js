"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[519],{4354(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>o,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"gazettes/api-reference","title":"API Reference","description":"The GztProcessor provides a FastAPI backend with endpoints for managing gazette data and state.","source":"@site/docs/gazettes/api-reference.md","sourceDirName":"gazettes","slug":"/gazettes/api-reference","permalink":"/research/docs/gazettes/api-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/vibhatha/research/tree/main/docs/docs/gazettes/api-reference.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"GztProcessor","permalink":"/research/docs/gazettes/processor"},"next":{"title":"Gazette Tracer","permalink":"/research/docs/gazettes/tracer"}}');var d=t(4848),r=t(8453);const i={sidebar_position:4},a="API Reference",c={},l=[{value:"Starting the API",id:"starting-the-api",level:2},{value:"MinDep Endpoints",id:"mindep-endpoints",level:2},{value:"State Management",id:"state-management",level:3},{value:"Gazette Processing",id:"gazette-processing",level:3},{value:"Example: Create Initial State",id:"example-create-initial-state",level:3},{value:"Example: Apply Amendment",id:"example-apply-amendment",level:3},{value:"Person Endpoints",id:"person-endpoints",level:2},{value:"State Management",id:"state-management-1",level:3},{value:"Gazette Processing",id:"gazette-processing-1",level:3},{value:"Example: Apply Person Transactions",id:"example-apply-person-transactions",level:3},{value:"Transaction Endpoints",id:"transaction-endpoints",level:2},{value:"Health Check",id:"health-check",level:2},{value:"Function Mapping",id:"function-mapping",level:2},{value:"Error Handling",id:"error-handling",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"api-reference",children:"API Reference"})}),"\n",(0,d.jsx)(n.p,{children:"The GztProcessor provides a FastAPI backend with endpoints for managing gazette data and state."}),"\n",(0,d.jsx)(n.h2,{id:"starting-the-api",children:"Starting the API"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"cd gazettes/preprocess\nuvicorn main:app --reload\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The API will be available at ",(0,d.jsx)(n.code,{children:"http://127.0.0.1:8000"})]}),"\n",(0,d.jsx)(n.h2,{id:"mindep-endpoints",children:"MinDep Endpoints"}),"\n",(0,d.jsx)(n.h3,{id:"state-management",children:"State Management"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Endpoint"}),(0,d.jsx)(n.th,{children:"Method"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/mindep/state/latest"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Get latest saved state (gazette number, date, state)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/mindep/state/{date}"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Get state(s) for a specific date"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/mindep/state/{date}/{gazette_number}"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Get specific state by date and gazette number"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/mindep/state/reset"})}),(0,d.jsx)(n.td,{children:"DELETE"}),(0,d.jsx)(n.td,{children:"Delete all MinDep state files and DB"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"gazette-processing",children:"Gazette Processing"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Endpoint"}),(0,d.jsx)(n.th,{children:"Method"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/mindep/initial/{date}/{gazette_number}"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Preview contents of initial gazette"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/mindep/initial/{date}/{gazette_number}"})}),(0,d.jsx)(n.td,{children:"POST"}),(0,d.jsx)(n.td,{children:"Create initial state in DB and save snapshot"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/mindep/amendment/{date}/{gazette_number}"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Detect transactions from amendment"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/mindep/amendment/{date}/{gazette_number}"})}),(0,d.jsx)(n.td,{children:"POST"}),(0,d.jsx)(n.td,{children:"Apply confirmed transactions to DB"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"example-create-initial-state",children:"Example: Create Initial State"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Request:"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://127.0.0.1:8000/mindep/initial/2022-07-22/2289-43" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "ministers": [\n      {\n        "name": "Ministry of Finance",\n        "departments": [\n          { "name": "Department of Treasury" },\n          { "name": "Inland Revenue" }\n        ]\n      }\n    ]\n  }\'\n'})}),"\n",(0,d.jsx)(n.h3,{id:"example-apply-amendment",children:"Example: Apply Amendment"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Request:"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://127.0.0.1:8000/mindep/amendment/2022-09-16/2297-78" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "transactions": {\n      "moves": [],\n      "adds": [\n        { "ministry": "Ministry of Finance", "department": "New Dept" }\n      ],\n      "terminates": []\n    }\n  }\'\n'})}),"\n",(0,d.jsx)(n.h2,{id:"person-endpoints",children:"Person Endpoints"}),"\n",(0,d.jsx)(n.h3,{id:"state-management-1",children:"State Management"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Endpoint"}),(0,d.jsx)(n.th,{children:"Method"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/person/state/latest"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Get latest saved persons and portfolios"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/person/state/{date}"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Get state(s) for a specific date"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/person/state/{date}/{gazette_number}"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Get specific person state by date and gazette number"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/person/state/reset"})}),(0,d.jsx)(n.td,{children:"DELETE"}),(0,d.jsx)(n.td,{children:"Delete all Person state files and DB"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"gazette-processing-1",children:"Gazette Processing"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Endpoint"}),(0,d.jsx)(n.th,{children:"Method"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/person/{date}/{gazette_number}"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Preview predicted transactions from person gazette"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/person/{date}/{gazette_number}"})}),(0,d.jsx)(n.td,{children:"POST"}),(0,d.jsx)(n.td,{children:"Apply reviewed transactions to DB"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"example-apply-person-transactions",children:"Example: Apply Person Transactions"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Request:"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://127.0.0.1:8000/person/2022-07-22/2067-09" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "transactions": {\n      "moves": [],\n      "adds": [\n        {\n          "person": "Hon. John Doe",\n          "ministry": "Ministry of Finance",\n          "position": "Minister"\n        }\n      ],\n      "terminates": []\n    }\n  }\'\n'})}),"\n",(0,d.jsx)(n.h2,{id:"transaction-endpoints",children:"Transaction Endpoints"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Endpoint"}),(0,d.jsx)(n.th,{children:"Method"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/transactions/"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Get all transactions"})]})})]}),"\n",(0,d.jsx)(n.h2,{id:"health-check",children:"Health Check"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Endpoint"}),(0,d.jsx)(n.th,{children:"Method"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/"})}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"Health check/status message"})]})})]}),"\n",(0,d.jsx)(n.h2,{id:"function-mapping",children:"Function Mapping"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Endpoint Type"}),(0,d.jsx)(n.th,{children:"Main Functions Called"}),(0,d.jsx)(n.th,{children:"Purpose"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MinDep Initial"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"extract_initial_gazette_data"}),", ",(0,d.jsx)(n.code,{children:"load_initial_state_to_db"})]}),(0,d.jsx)(n.td,{children:"Extract/load initial ministry structure"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MinDep Amendment"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"process_amendment_gazette"}),", ",(0,d.jsx)(n.code,{children:"apply_transactions_to_db"})]}),(0,d.jsx)(n.td,{children:"Detect/apply department changes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Person Gazette"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"process_person_gazette"}),", ",(0,d.jsx)(n.code,{children:"apply_transactions_to_db"})]}),(0,d.jsx)(n.td,{children:"Detect/apply person-portfolio changes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"State Management"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"get_latest_state"}),", ",(0,d.jsx)(n.code,{children:"get_state_by_date"}),", ",(0,d.jsx)(n.code,{children:"load_state"}),", ",(0,d.jsx)(n.code,{children:"clear_all_state_data"})]}),(0,d.jsx)(n.td,{children:"Manage and reset state snapshots"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,d.jsx)(n.p,{children:"The API returns JSON error messages for:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Missing files"}),"\n",(0,d.jsx)(n.li,{children:"Invalid requests"}),"\n",(0,d.jsx)(n.li,{children:"Resources not found"}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["Always check the response for an ",(0,d.jsx)(n.code,{children:"error"})," key if your request fails."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{\n  "error": "State file not found for date 2022-01-01"\n}\n'})})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},8453(e,n,t){t.d(n,{R:()=>i,x:()=>a});var s=t(6540);const d={},r=s.createContext(d);function i(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);